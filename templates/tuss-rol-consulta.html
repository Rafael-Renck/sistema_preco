{% extends 'base.html' %}
{% block title %}Consulta TUSS x ROL{% endblock %}
{% block content %}
<div class="page-header d-flex align-items-center justify-content-between flex-wrap gap-2">
  <h4 class="mb-0">Consulta Rápida — TUSS x ROL ANS</h4>
  <a class="btn btn-sm btn-outline-secondary btn-icon" href="{{ url_for('tuss_rol_consulta') }}"><i data-lucide="arrow-clockwise"></i> Limpar</a>
</div>

<div class="row g-3">
  <div class="col-12 col-lg-4">
    <div class="card h-100 p-3">
      <div class="section-title mb-1">Códigos TUSS</div>
      <div class="soft mb-3">
        Informe um ou mais códigos (um por linha ou separados por vírgula/semicolons). O sistema retorna se cada código consta no ROL de Procedimentos da ANS.
      </div>
      <form method="post" class="d-flex flex-column gap-3">
        <div>
          <label class="form-label" for="codigosInput">Códigos</label>
          <textarea class="form-control" id="codigosInput" name="codigos" rows="10" placeholder="10101010&#10;20102030">{{ entrada or '' }}</textarea>
          <div class="form-text">Ex.: <code>30101018</code>, <code>30101026</code></div>
        </div>
        <button class="btn btn-primary btn-icon" type="submit">
          <i data-lucide="search"></i> Consultar
        </button>
      </form>
    </div>
  </div>

  <div class="col-12 col-lg-8">
    <div class="card h-100 p-3">
      <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">
        <div>
          <div class="section-title mb-1">Resultado</div>
          <div class="soft">
            {% if resumo.total %}
              {{ resumo.total }} código(s) verificado(s): {{ resumo.consta }} no ROL, {{ resumo.nao_consta }} fora do ROL, {{ resumo.nao_encontrado }} sem correlação.
            {% else %}
              Nenhum código consultado ainda.
            {% endif %}
          </div>
        </div>
        {% if resumo.total %}
        <div class="badge rounded-pill text-bg-info-subtle text-info fw-semibold px-3 py-2">
          <i class="bi bi-clipboard-check me-1"></i> Atualizações realizadas via módulo administrativo.
        </div>
        {% endif %}
      </div>
      <hr>
      <div class="table-responsive" style="max-height:520px;">
        <table class="table table-sm align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th style="width:120px;">Código</th>
              <th>Descrição</th>
              <th style="width:150px;" class="text-center">Consta no ROL?</th>
            </tr>
          </thead>
          <tbody>
            {% for item in resultados %}
              <tr>
                <td class="fw-semibold">{{ item.codigo }}</td>
                <td>{{ item.descricao or '-' }}</td>
                <td class="text-center">
                  {% if item.consta is true %}
                    <span class="badge text-bg-success">Sim</span>
                  {% elif item.consta is false %}
                    <span class="badge text-bg-secondary">Não</span>
                  {% else %}
                    <span class="badge text-bg-warning text-dark">Não encontrado</span>
                  {% endif %}
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan="3" class="text-center text-muted py-4">
                  Informe os códigos ao lado para consultar a situação no ROL.
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
