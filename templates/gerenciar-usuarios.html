{% extends 'base.html' %}
{% block title %}Usuários{% endblock %}
{% block content %}
<div class="page-header d-flex align-items-center justify-content-between">
  <h4 class="mb-0">Gerenciamento de Usuários</h4>
  <a class="btn btn-primary" href="{{ url_for('usuario_novo') }}">Adicionar Usuário</a>
</div>

<div class="card p-0">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr><th>ID</th><th>Nome</th><th>E-mail</th><th>Nível</th><th>Operadora</th><th class="text-end">Ações</th></tr>
      </thead>
      <tbody>
        {% for u in usuarios %}
        <tr>
          <td>{{ u.id }}</td>
          <td>{{ u.nome }}</td>
          <td>{{ u.email }}</td>
          <td>
            {% set cls = 'text-bg-secondary' %}
            {% if u.perfil == 'adm' %}{% set cls = 'text-bg-dark' %}
            {% elif u.perfil == 'auditor' %}{% set cls = 'text-bg-info' %}
            {% elif u.perfil == 'operadora' %}{% set cls = 'text-bg-success' %}{% endif %}
            <span class="badge {{ cls }}">{{ u.perfil }}</span>
          </td>
          {% set operadora_nomes = u.operadoras | map(attribute='nome') | list %}
          <td>{{ operadora_nomes|join(', ') if operadora_nomes else 'Todas' }}</td>
          <td class="text-end">
            <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('usuario_editar', uid=u.id) }}">Editar</a>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="6" class="text-center text-secondary py-4">Nenhum usuário cadastrado</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
